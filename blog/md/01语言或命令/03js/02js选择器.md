# JavaScript DOM 选择器完整指南

## 引言

在 JavaScript 中，DOM (文档对象模型) 选择器是用于查找和访问网页上特定 HTML 元素（即 DOM 节点）的工具。能够精确、高效地选中元素是进行任何网页动态交互（如修改内容、更改样式、绑定事件等）的第一步。

JavaScript 的选择器可以主要分为两大类：
1.  **专用选择器方法**：早期原生 API，针对特定属性（如 ID, 类名）进行选择，速度快但灵活性较低。
2.  **通用选择器方法**：现代 API，使用强大的 CSS 选择器语法，极度灵活，是目前的主流。

本文档将对这些选择器进行详细的分类、解释和比较。

---

## 类别一：专用选择器方法 (Legacy / Dedicated Selectors)

这类方法直接、高效，但功能单一。它们返回的是 **动态集合 (Live Collection)** `HTMLCollection` 或 `NodeList`，这意味着当文档中的元素发生变化时，这些集合会自动更新。

### 1. `document.getElementById(id)`

- **功能**：通过元素的 `id` 属性选择一个唯一的元素。`id` 在整个文档中应当是唯一的。
- **返回值**：
    - 如果找到，返回该元素的 `Element` 对象。
    - 如果未找到，返回 `null`。
- **特点**：速度极快，是获取单个元素最可靠和最高效的方法。
- **示例**：
  ```html
  <div id="main-container"></div>
  ```
  ```javascript
  const container = document.getElementById('main-container');
  console.log(container); // 输出 <div id="main-container">...</div>
  ```

### 2. `document.getElementsByTagName(tagName)`

- **功能**：通过元素的标签名（如 'p', 'div', 'a'）选择所有匹配的元素。
- **返回值**：
    - 返回一个包含所有匹配元素的 **动态 `HTMLCollection`**。
    - 如果没有找到，返回一个空的 `HTMLCollection` (length 为 0)。
- **特点**：返回的是一个动态集合。可以在 `document` 或任何一个元素节点上调用（如 `element.getElementsByTagName('p')`）。
- **示例**：
  ```html
  <p>段落一</p>
  <p>段落二</p>
  ```
  ```javascript
  const allParagraphs = document.getElementsByTagName('p');
  for (let p of allParagraphs) {
      p.style.color = 'blue';
  }
  ```

### 3. `document.getElementsByClassName(classNames)`

- **功能**：通过元素的 `class` 属性选择所有匹配的元素。可以传入一个或多个类名（用空格分隔）。
- **返回值**：
    - 返回一个包含所有匹配元素的 **动态 `HTMLCollection`**。
    - 如果没有找到，返回一个空的 `HTMLCollection`。
- **特点**：同样返回动态集合，并且可以匹配拥有多个指定类名的元素。
- **示例**：
  ```html
  <div class="item active">项目1</div>
  <div class="item">项目2</div>
  <span class="item active">项目3</span>
  ```
  ```javascript
  // 选择所有同时拥有 'item' 和 'active' 类的元素
  const activeItems = document.getElementsByClassName('item active');
  console.log(activeItems.length); // 输出 2
  ```

### 4. `document.getElementsByName(name)`

- **功能**：通过元素的 `name` 属性选择所有匹配的元素。
- **返回值**：
    - 返回一个包含所有匹配元素的 **动态 `NodeList`**。
- **特点**：主要用于表单元素（如 `<input>`, `<select>`, `<button>` 等），因为 `name` 属性在表单提交中非常重要。注意，它返回的是 `NodeList` 而不是 `HTMLCollection`。
- **示例**：
  ```html
  <input type="radio" name="gender" value="male"> 男
  <input type="radio" name="gender" value="female"> 女
  ```
  ```javascript
  const genderRadios = document.getElementsByName('gender');
  console.log(genderRadios.length); // 输出 2
  ```

---

## 类别二：通用选择器方法 (Modern / CSS-based Selectors)

这类方法使用 CSS 选择器字符串作为参数，功能强大且灵活，是现代 Web 开发的首选。它们返回的是 **静态集合 (Static Collection)**，不会随 DOM 的变化而自动更新。

### 1. `document.querySelector(selectors)`

- **功能**：接收一个 CSS 选择器字符串，返回文档中 **第一个** 匹配该选择器的元素。
- **返回值**：
    - 如果找到，返回匹配的 `Element` 对象。
    - 如果未找到，返回 `null`。
- **特点**：极其灵活，可以使用任何复杂的 CSS 选择器。只会返回第一个匹配项。
- **示例**：
  ```html
  <div class="content">
      <p class="text">第一个段落</p>
      <p class="text">第二个段落</p>
  </div>
  ```
  ```javascript
  // 选择 .content 下的第一个 p 元素
  const firstParagraph = document.querySelector('.content p');
  firstParagraph.style.fontWeight = 'bold';
  ```

### 2. `document.querySelectorAll(selectors)`

- **功能**：接收一个 CSS 选择器字符串，返回文档中 **所有** 匹配该选择器的元素。
- **返回值**：
    - 返回一个包含所有匹配元素的 **静态 `NodeList`**。
    - 如果没有找到，返回一个空的 `NodeList` (length 为 0)。
- **特点**：
    - 返回的是静态集合，性能上比动态集合更有预见性。
    - `NodeList` 可以直接使用 `forEach` 方法进行遍历，而 `HTMLCollection` 通常需要先转换为数组。
- **示例**：
  ```html
  <ul>
      <li><a href="#">链接1</a></li>
      <li><span>非链接</span></li>
      <li><a href="#">链接2</a></li>
  </ul>
  ```
  ```javascript
  // 选择 ul 下的所有 a 元素
  const allLinks = document.querySelectorAll('ul li a');
  allLinks.forEach(link => {
      link.classList.add('external-link');
  });
  ```

### CSS 选择器语法支持（`querySelector` 和 `querySelectorAll`）

以下是它们支持的常用 CSS 选择器类型：

| 类型 | 语法 | 示例 | 描述 |
| :--- | :--- | :--- | :--- |
| **基础选择器** | | | |
| 类型选择器 | `element` | `p` | 选择所有 `<p>` 元素 |
| 类选择器 | `.classname` | `.info` | 选择所有 class 包含 "info" 的元素 |
| ID 选择器 | `#id` | `#header` | 选择 id 为 "header" 的元素 |
| 通用选择器 | `*` | `*` | 选择所有元素 |
| 属性选择器 | `[attr]` `[attr=val]` | `[type="submit"]` | 选择具有特定属性或属性值的元素 |
| **组合器** | | | |
| 后代组合器 | `A B` | `div p` | 选择 `<div>` 内部的所有 `<p>` 元素 |
| 子代组合器 | `A > B` | `ul > li` | 选择 `<ul>` 的直接子元素 `<li>` |
| 相邻兄弟组合器 | `A + B` | `h2 + p` | 选择紧跟在 `<h2>` 后面的第一个 `<p>` 元素 |
| 通用兄弟组合器 | `A ~ B` | `h2 ~ p` | 选择在 `<h2>` 后面的所有同级 `<p>` 元素 |
| **分组选择器** | `A, B` | `h1, h2, .title` | 选择所有 `<h1>`, `<h2>` 和 class 为 "title" 的元素 |
| **伪类选择器** | | | |
| 状态伪类 | `:hover`, `:focus` | `a:hover` | 选择鼠标悬停状态的 `<a>` |
| 结构性伪类 | `:first-child`, `:nth-child(n)` | `li:nth-child(2n)` | 选择偶数位置的 `<li>` |
| 否定伪类 | `:not(selector)` | `p:not(.special)` | 选择所有不包含 "special" 类的 `<p>` 元素 |
| **伪元素选择器**| `::before`, `::after` | `p::first-line` | **注意**：JS 选择器无法选中伪元素，因为它们不是真实的 DOM 节点。|

---

## 类别三：其他相关节点选择方式

这些不是严格意义上的“选择器”，而是通过节点之间的关系来访问元素的属性和方法。

### 1. Document 根节点属性

- `document.documentElement`: 指向文档的根元素，即 `<html>`。
- `document.head`: 指向文档的 `<head>` 元素。
- `document.body`: 指向文档的 `<body>` 元素。

### 2. DOM 遍历 (DOM Traversal)

从一个已知元素开始，通过其亲属关系查找其他元素。

- **父节点**:
    - `element.parentElement`: 返回元素的父 `Element` 节点。
    - `element.parentNode`: 返回元素的父节点（可能是元素、文档等）。
- **子节点**:
    - `element.children`: 返回一个 **动态 `HTMLCollection`**，包含元素的所有 `Element` 子节点。
    - `element.childNodes`: 返回一个 **动态 `NodeList`**，包含所有子节点（包括文本节点、注释节点）。
    - `element.firstElementChild` / `element.lastElementChild`: 返回第一个/最后一个 `Element` 子节点。
- **兄弟节点**:
    - `element.nextElementSibling` / `element.previousElementSibling`: 返回下一个/上一个兄弟 `Element` 节点。

---

## 总结与对比

| 方法 | 返回值类型 | 实时性 | 性能 | 灵活性 | 主要用途 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| `getElementById()` | `Element` / `null` | - | **极高** | 低 | 按唯一 ID 精准获取单个元素 |
| `getElementsByTagName()` | `HTMLCollection` | **动态** | 高 | 低 | 按标签名批量获取元素 |
| `getElementsByClassName()`| `HTMLCollection` | **动态** | 高 | 低 | 按类名批量获取元素 |
| `getElementsByName()` | `NodeList` | **动态** | 中 | 低 | 按 name 属性获取表单元素 |
| `querySelector()` | `Element` / `null` | **静态** | 较高 | **极高** | 使用 CSS 选择器获取 **第一个** 匹配的元素 |
| `querySelectorAll()` | `NodeList` | **静态** | 较高 | **极高** | 使用 CSS 选择器获取 **所有** 匹配的元素 |

### 关键区别：`HTMLCollection` vs `NodeList`

- **实时性**：`HTMLCollection` 是动态的，DOM 变化会实时反映在集合中。`querySelectorAll` 返回的 `NodeList` 是静态的，它是在你调用那一刻的快照。
- **包含内容**：`HTMLCollection` 只包含元素节点（`Element`）。`NodeList` 可以包含任何类型的节点（元素、文本、注释等），尽管 `querySelectorAll` 返回的 `NodeList` 只包含元素节点。
- **方法**：`NodeList` 提供了 `forEach`、`keys`、`values` 等迭代方法，更易于使用。`HTMLCollection` 需要通过 `Array.from()` 转换为数组后才能使用这些方法。

## 最佳实践与建议

1.  **首选 `querySelector` 和 `querySelectorAll`**：
    由于其无与伦比的灵活性和强大的功能，这两个方法应作为你的首选。它们能处理几乎所有的选择场景，并且代码更具表现力。

2.  **使用 `getElementById` 获取唯一元素**：
    当你明确需要通过 ID 获取一个唯一的元素时，`getElementById` 是最直接、最快的选择。

3.  **谨慎使用动态集合**：
    `getElementsBy...` 返回的动态集合在某些场景下很有用（如需要实时监控某类元素的变化），但也可能导致意外的 bug，特别是在循环中修改 DOM 时。例如，在循环中删除集合中的元素可能导致循环跳过某些元素。

4.  **将集合转换为数组进行复杂操作**：
    当你需要对获取到的元素集合使用 `map`、`filter`、`reduce` 等数组方法时，使用 `Array.from()` 将 `HTMLCollection` 或 `NodeList` 转换为真正的数组。
    ```javascript
    const allDivs = document.getElementsByTagName('div');
    const divArray = Array.from(allDivs);
    divArray.filter(div => div.hasAttribute('data-active'));
    ```