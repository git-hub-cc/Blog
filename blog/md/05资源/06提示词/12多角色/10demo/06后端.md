### **1. 数据库模型设计 (Database Model Design)**

为了支持PRD中的核心功能，我们需要设计能够存储用户、桌面上的项目（应用和文件夹）以及用户个性化设置的数据表。

**核心表设计如下：**

#### **表一：`users`**

*   **说明：** 存储用户信息，是所有数据归属的根源。
*   **字段：**
    *   `id` (SERIAL, PRIMARY KEY): 用户唯一标识，自增主键。
    *   `email` (VARCHAR(255), UNIQUE, NOT NULL): 电子邮箱，用于登录。
    *   `password_hash` (VARCHAR(255), NOT NULL): 存储加盐哈希后的密码。
    *   `created_at` (TIMESTAMPTZ, DEFAULT now()): 记录创建时间。
    *   `updated_at` (TIMESTAMPTZ, DEFAULT now()): 记录最后更新时间。

#### **表二：`desktop_items`**

*   **说明：** 这是核心模型，用于存储桌面上的所有项目，包括“应用快捷方式”和“文件夹”。
*   **字段：**
    *   `id` (SERIAL, PRIMARY KEY): 项目唯一标识。
    *   `user_id` (INTEGER, NOT NULL, FOREIGN KEY REFERENCES `users(id)` ON DELETE CASCADE): 外键，表明该项目属于哪个用户。
    *   `parent_id` (INTEGER, FOREIGN KEY REFERENCES `desktop_items(id)` ON DELETE SET NULL): 外键，自引用。如果为`NULL`，则表示项目在根桌面；否则，表示它在某个文件夹内。当父文件夹被删除时，子项将被置为孤立，由应用逻辑处理。
    *   `item_type` (VARCHAR(10), NOT NULL): 项目类型, `'APP'` 或 `'FOLDER'`。
    *   `name` (VARCHAR(100), NOT NULL): 项目显示名称。
    *   `icon_url` (VARCHAR(2048)): 项目图标的URL。
    *   `url` (TEXT): 仅当 `item_type` 为 `'APP'` 时有效。
    *   `position` (JSONB): 用于存储项目在桌面或文件夹内的位置，如 `{ "x": 100, "y": 150 }`。
    *   `status` (VARCHAR(10), NOT NULL, DEFAULT 'ACTIVE'): 项目状态，用于支持回收站功能。 `'ACTIVE'` 表示在桌面上可见，`'TRASHED'` 表示已移入回收站。
    *   `created_at` (TIMESTAMPTZ, DEFAULT now()): 记录创建时间。
    *   `updated_at` (TIMESTAMPTZ, DEFAULT now()): 记录最后更新时间。

#### **表三：`user_settings`**

*   **说明：** 存储用户的个性化配置，与`users`表形成一对一关系。
*   **字段：**
    *   `user_id` (INTEGER, PRIMARY KEY, FOREIGN KEY REFERENCES `users(id)` ON DELETE CASCADE): 用户ID。
    *   `wallpaper_url` (TEXT): 桌面壁纸的URL。
    *   `theme` (VARCHAR(20), DEFAULT 'win10-dark'): 主题名称。
    *   `updated_at` (TIMESTAMPTZ, DEFAULT now()): 记录最后更新时间。

---

### **2. API 端点设计 (API Endpoint Design)**

所有API路径以 `/api/v1/` 为前缀。非认证相关API需要进行认证保护（例如通过JWT）。

#### **认证API (Auth)**

*   **注册:** `POST /api/v1/auth/register`
    *   **请求正文:** `{ "email": "user@example.com", "password": "securepassword123" }`
    *   **成功响应 (201 Created):** `{ "id": 1, "email": "user@example.com" }`
*   **登录:** `POST /api/v1/auth/login`
    *   **请求正文:** `{ "email": "user@example.com", "password": "securepassword123" }`
    *   **成功响应 (200 OK):** `{ "token": "jwt.token.string" }`

#### **桌面项目API (Desktop Items)**

*   **获取当前用户的桌面所有项目:** `GET /api/v1/desktop-items`
    *   **说明:** 此端点仅返回 `status` 为 `'ACTIVE'` 的项目。
    *   **成功响应 (200 OK):**
        ```json
        {
          "items": [
            { "id": 1, "parentId": null, "itemType": "APP", "name": "个人博客", "iconUrl": "...", "url": "...", "position": { "x": 50, "y": 50 }, "status": "ACTIVE" },
            { "id": 2, "parentId": null, "itemType": "FOLDER", "name": "客户项目", "iconUrl": "...", "position": { "x": 50, "y": 150 }, "status": "ACTIVE" },
            { "id": 3, "parentId": 2, "itemType": "APP", "name": "客户A Demo", "iconUrl": "...", "url": "...", "position": { "x": 20, "y": 20 }, "status": "ACTIVE" }
          ]
        }
        ```

*   **创建一个新的桌面项目:** `POST /api/v1/desktop-items`
    *   **请求正文 (JSON):**
        ```json
        {
          "parentId": null, // or a folder's ID
          "itemType": "APP", // "APP" or "FOLDER"
          "name": "我的新工具",
          "iconUrl": "...",
          "url": "https://my-new-tool.dev", // Required if itemType is "APP"
          "position": { "x": 200, "y": 50 }
        }
        ```
    *   **成功响应 (201 Created):** 返回新创建的item对象。

*   **更新桌面项目信息:** `PATCH /api/v1/desktop-items/{itemId}`
    *   **请求正文 (JSON):** (只需提供需要修改的字段, e.g., `name`, `position`, `parentId`)
    *   **成功响应 (200 OK):** 返回更新后的item对象。

*   **删除桌面项目 (移至回收站):** `DELETE /api/v1/desktop-items/{itemId}`
    *   **说明:** 此操作为**软删除**。它会将指定项目及其所有子项（如果是文件夹）的 `status` 字段更新为 `'TRASHED'`。
    *   **成功响应 (204 No Content):** 响应体为空。

*   **（未来）回收站管理API:**
    *   `GET /api/v1/trash-items`: 获取回收站中的所有项目。
    *   `POST /api/v1/trash-items/{itemId}/restore`: 恢复指定项目。
    *   `DELETE /api/v1/trash-items/{itemId}`: 永久删除指定项目。

#### **用户设置API (User Settings)**

*   **获取用户设置:** `GET /api/v1/user/settings`
    *   **成功响应 (200 OK):** `{ "wallpaperUrl": "...", "theme": "..." }`
*   **更新用户设置:** `PUT /api/v1/user/settings`
    *   **请求正文 (JSON):** `{ "wallpaperUrl": "https://new-wallpaper.com/image.jpg" }`
    *   **成功响应 (200 OK):** 返回更新后的settings对象。