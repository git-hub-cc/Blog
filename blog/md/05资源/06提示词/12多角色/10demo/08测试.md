### **功能测试用例 (Functional Test Cases)**

**功能模块：** 核心体验 (应用创建与管理 & 用户认证)

#### **1. 测试用例 (Test Cases)**

| 用例ID | 用例标题 | 前置条件 | 测试步骤 | 预期结果 |
| :--- | :--- | :--- | :--- | :--- |
| **TC-AUTH-001** | **成功注册新用户** | 用户位于注册页面。 | 1. 输入一个未被注册的有效邮箱和密码。<br>2. 点击“注册”按钮。 | 1. 提示注册成功。<br>2. 页面跳转到登录页。 |
| **TC-AUTH-002** | **使用已存在的邮箱注册 (异常)** | 用户位于注册页面。 | 1. 输入一个已经被注册过的邮箱。<br>2. 点击“注册”按钮。 | 1. 提示“该邮箱已被注册”或类似错误信息。<br>2. 页面停留在注册页。 |
| **TC-AUTH-003** | **成功登录** | 用户已成功注册，位于登录页面。 | 1. 输入正确的邮箱和密码。<br>2. 点击“登录”按钮。 | 1. 登录成功。<br>2. 页面跳转到WebTop主桌面。 |
| **TC-AUTH-004** | **使用错误的密码登录 (异常)** | 用户已成功注册，位于登录页面。 | 1. 输入正确的邮箱和错误的密码。<br>2. 点击“登录”按钮。 | 1. 提示“邮箱或密码错误”。<br>2. 页面停留在登录页。 |
| **TC-P0-001** | **成功创建并打开一个应用 (Happy Path)** | 用户已登录，位于主桌面。 | 1. 在桌面空白处点击右键。<br>2. 在菜单中选择“创建应用”。<br>3. 在对话框中，输入名称：“个人博客”，URL：“https://example.com”。<br>4. 点击“创建”。<br>5. 双击新出现的“个人博客”图标。 | 1. 桌面上出现一个名为“个人博客”的新图标。<br>2. 一个新窗口打开，窗口标题为“个人博客”。<br>3. 窗口内容成功加载 `https://example.com` 的网页。<br>4. 任务栏上出现对应图标。 |
| **TC-P0-002** | **验证应用窗口的完整操作** | 桌面上已有一个打开的应用窗口。 | 1. 拖动窗口标题栏。<br>2. 拖动窗口边缘调整大小。<br>3. 点击“最小化”按钮。<br>4. 点击任务栏上对应的应用图标。<br>5. 点击“最大化”按钮。<br>6. 点击“还原”按钮。<br>7. 点击“关闭”按钮。 | 1. 窗口跟随鼠标移动。<br>2. 窗口尺寸实时变化。<br>3. 窗口消失，任务栏图标保持激活状态。<br>4. 窗口恢复到最小化前的位置和尺寸。<br>5. 窗口铺满桌面（任务栏除外）。<br>6. 窗口恢复到最大化前的位置和尺寸。<br>7. 窗口关闭，任务栏图标消失。 |
| **TC-P0-003** | **创建应用时输入为空 (异常)** | 用户已登录，位于主桌面。 | 1. 打开“创建应用”对话框。<br>2. 不输入任何名称和URL。<br>3. 点击“创建”按钮。 | 1. 提示“名称和URL不能为空”。<br>2. 对话框不关闭。 |
| **TC-P0-004** | **打开一个禁止被iframe嵌套的网站 (异常)** | 用户已创建一个应用，其URL为 `https://google.com`。 | 1. 双击该应用的图标。 | 1. 应用窗口正常打开。<br>2. 窗口内容区域显示浏览器自身的错误信息（如“google.com 拒绝了连接请求”）。<br>3. WebTop应用本身不应崩溃。 |

---

### **2. 需要关注的边界条件 (Edge Cases to Consider)**

1.  **URL协议多样性：**
    *   用户输入的URL可能是 `http`、`https` 之外的协议。系统应如何处理？建议进行白名单过滤，只允许 `http/https`。

2.  **性能与资源消耗：**
    *   当用户打开一个资源密集型的网页（如WebGL游戏）时，该“应用窗口”的拖拽、缩放等操作是否会变得卡顿？同时打开多个应用时，整个“桌面”的性能表现如何？

3.  **超长名称与图标显示：**
    *   当用户为应用创建一个非常长的名称时，桌面图标下方的文字是否会正确截断或换行，以避免破坏布局？
        --- START OF FILE 09运维.md ---

好的，收到。作为一名经验丰富的DevOps工程师，我已经仔细分析了技术总监（CTO）制定的这份技术选型方案。这是一个非常现代且明智的选择，充分利用了PaaS和Serverless的优势。

基于这份方案，我设计了以下自动化、高可用的 **部署与运维策略**。

---

**致：** 技术总监 & 项目团队
**发件人：** DevOps工程师
**日期：** 2023年10月27日
**主题：** WebTop 项目的部署与运维策略

### **总览**

本策略旨在为CTO选定的 **"全栈TypeScript + Serverless"** 技术栈（React, Express, PostgreSQL）提供一个与之匹配的、高度自动化的运维体系。核心目标是：**实现真正的持续集成与持续部署 (CI/CD)**、**构建零信任且免运维的基础设施**，以及 **建立主动式、可预测的监控告警机制**。

---

### **1. CI/CD 流水线设计 (CI/CD Pipeline Design)**

我们将采用基于Git的“GitOps”工作流，Vercel平台原生支持这种模式。

1.  **开发与代码审查 (Development & PR):**
    *   开发者将代码推送到Git仓库的**特性分支**，并创建一个**拉取请求 (PR)**到 `main` 分支。

2.  **自动化预览与测试 (Automated Preview & CI Checks):**
    *   PR的创建会自动触发 **Vercel**，为这个PR构建一个隔离的**预览环境**，并生成唯一URL。
    *   同时，配置**GitHub Actions**来运行CI检查，包括代码风格检查 (Linting) 和单元测试 (Unit Tests)。

3.  **合并到生产 (Merge to Production):**
    *   PR通过所有检查和审查后，合并到 `main` 分支。

4.  **自动化生产部署 (Automated Production Deployment):**
    *   代码合并到 `main` 分支的动作会再次自动触发 **Vercel**，执行一个**生产构建**，将优化后的前端静态资源和后端Serverless Functions部署到主域名，实现**零停机部署**。

---

### **2. 生产环境基础设施规划 (Production Infrastructure Plan)**

我们将完全拥抱PaaS/Serverless方案，避免管理任何虚拟机或容器。

*   **前端应用 (Front-end):**
    *   由 **Vercel的全球边缘网络 (Global Edge Network)** 托管，为全球用户提供极低的加载延迟。

*   **后端服务 (Back-end):**
    *   Express应用将被部署为 **Vercel Serverless Functions**。每个API路由都是一个独立的、按需执行的函数，具备高可用与自动扩缩容能力。

*   **数据库 (Database):**
    *   使用 **Neon** 或 **Supabase** 等全托管的 **Serverless PostgreSQL** 服务。
    *   **高可用与备份:** 这些服务内置了高可用性配置和自动备份策略，我们只需进行简单的配置即可保障数据安全，无需手动管理。

*   **配置与安全:**
    *   所有敏感信息，如数据库连接字符串、JWT密钥等，将作为**环境变量**存储在Vercel的项目设置中。
    *   在数据库提供商的管理平台中，我们将配置网络访问规则，例如仅允许来自特定来源的连接或要求SSL，以增强安全性。

---

### **3. 监控与告警策略 (Monitoring & Alerting Strategy)**

我们将利用Vercel和数据库服务商内置的监控工具，并设置关键告警。

*   **指标1：函数错误率 (Function Error Rate - 5xx)**
    *   **监控来源：** Vercel Monitoring
    *   **描述：** 衡量后端服务健康状况最直接的指标。
    *   **告警条件：** **在任意5分钟窗口内，错误率持续超过 2%**。这表明存在一个持续性的问题，需要立即介入调查。

*   **指标2：函数调用时长 P95 (95th Percentile Function Invocation Duration)**
    *   **监控来源：** Vercel Monitoring
    *   **描述：** 反映绝大多数用户的真实API体验。
    *   **告警条件：** **P95 响应时间持续超过 800ms**。这通常预示着数据库慢查询或代码瓶颈。

*   **指标3：数据库连接数 (Database Connections)**
    *   **监控来源：** Neon / Supabase Monitoring
    *   **描述：** 托管的PostgreSQL服务通常有连接数上限。连接数异常飙升可能导致服务中断。
    *   **告警条件：** **当前连接数超过集群最大限制的 85%**。这给了我们一个缓冲期，在服务完全不可用之前进行排查。