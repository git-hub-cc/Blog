# 系统工程

本文汇总现代系统工程与工程效能相关方法，包含：微服务架构、DevOps & CI/CD、技术债务。

---

## 一、微服务架构（Microservices Architecture）

### 什么是微服务架构？
将单一应用开发为一组小型、独立、松耦合的服务。每个服务运行在自己的进程中，围绕业务能力构建，通过轻量级通信机制（HTTP REST 或消息队列）通信，可独立部署、独立扩展和独立开发。

### 按通信模式分类

| 通信模式     | 典型技术        | 优点                     | 缺点                           |
| ------------ | --------------- | ------------------------ | ------------------------------ |
| **同步通信** | HTTP/REST, gRPC | 实时性强，模型简单       | 紧密耦合，可能级联故障（雪崩） |
| **异步通信** | RabbitMQ, Kafka | 高解耦，高可用，削峰填谷 | 复杂性高，最终一致性，调试困难 |

### 按数据管理策略分类

#### 每个服务一个数据库（推荐）
- **优点**：高度自治，可选不同技术（MySQL/MongoDB/Elasticsearch），独立扩展
- **缺点**：分布式事务复杂（需 Saga/TCC），数据冗余，跨服务查询困难

#### 共享数据库（反模式）
- **优点**：迁移简单，事务简单，数据一致性强
- **缺点**：紧密耦合（数据库是最强耦合点），失去技术异构性，违背微服务核心原则

### 按服务编排与协作方式分类

| 模式                          | 描述                                             | 优点                 | 缺点                         |
| ----------------------------- | ------------------------------------------------ | -------------------- | ---------------------------- |
| **编排模式（Orchestration）** | 中心"编排者"调用协调其他服务，类似乐队指挥       | 逻辑集中，易理解监控 | 中心化风险，服务与编排者耦合 |
| **协作模式（Choreography）**  | 无中央协调者，各服务监听和发布事件，类似舞台舞者 | 高度解耦，无单点瓶颈 | 业务逻辑分散，监控调试复杂   |

### 按业务职责分类（来自 DDD）

| 类型           | 示例                       | 特点                                 |
| -------------- | -------------------------- | ------------------------------------ |
| **核心域服务** | 电商订单服务、金融交易服务 | 核心竞争力，逻辑最复杂，投入最优资源 |
| **支撑域服务** | 评论管理、库存管理         | 必需但非核心，业务逻辑相对固定       |
| **通用域服务** | 认证授权、短信通知         | 功能标准化，应尽量购买/使用开源方案  |

### 按有状态与无状态分类

| 类型           | 特点                                     | 示例                             |
| -------------- | ---------------------------------------- | -------------------------------- |
| **无状态服务** | 极易水平扩展，高可用，负载均衡简单       | 大多数业务逻辑服务               |
| **有状态服务** | 高性能，但扩展复杂，需 StatefulSets 管理 | 数据库、Redis缓存、WebSocket服务 |

### 按部署与运行环境分类

- **容器化**（Docker + Kubernetes）：最主流，环境一致性、资源隔离、自动化运维
- **无服务器/FaaS**（AWS Lambda, Azure Functions）：极致弹性伸缩，按需付费，适合事件驱动
- **传统虚拟机/物理机**：资源利用率低，逐渐被容器化取代

### 总结
对微服务进行分类不是为了贴标签，而是为了拥有强大的分析工具。真实世界的复杂系统通常是混合体：同步+异步通信并存，大部分服务每服务一个数据库，部分流程用编排而部分用协作，核心域/支撑域/通用域服务并存。

---

## 二、DevOps 与 CI/CD

### 摘要
DevOps（Development and Operations）是文化理念、实践方法和工具集的结合，旨在打破开发与运维的壁垒，实现更高质量、更可靠、更频繁的软件交付。

### 一、按核心理念分类（CALMS 框架）

| 支柱                         | 描述                             | 核心实践                              |
| ---------------------------- | -------------------------------- | ------------------------------------- |
| **C - Culture（文化）**      | 打破部门墙，建立协作和共同责任感 | 无指责文化、跨职能团队、知识共享      |
| **A - Automation（自动化）** | 将可重复易出错的手动任务自动化   | CI/CD、IaC、自动化测试和监控          |
| **L - Lean（精益）**         | 专注创造客户价值，消除浪费       | 价值流图、小批量发布、WIP限制、Kanban |
| **M - Measurement（度量）**  | 没有度量就无法改进               | 部署频率、变更前置时间、MTTR、错误率  |
| **S - Sharing（共享）**      | 知识、工具和责任的共享           | 内部开源、代码评审、统一沟通平台      |

### 二、按软件生命周期阶段分类

| 阶段                | 描述                            | 代表工具                       |
| ------------------- | ------------------------------- | ------------------------------ |
| **Plan（规划）**    | 敏捷规划，用户故事，Backlog管理 | Jira, Trello, Confluence       |
| **Code（编码）**    | 版本控制，代码评审，分支策略    | Git, GitHub, GitLab            |
| **Build（构建）**   | CI核心，自动化构建和打包        | Jenkins, GitLab CI, CircleCI   |
| **Test（测试）**    | 单元/集成/E2E/安全/性能测试     | JUnit, Selenium, SonarQube     |
| **Release（发布）** | 制品管理，版本管理              | Nexus, JFrog Artifactory       |
| **Deploy（部署）**  | IaC，配置管理，蓝绿/金丝雀发布  | Terraform, Kubernetes, Ansible |
| **Operate（运维）** | 容器化管理，高可用架构          | Docker, Kubernetes             |
| **Monitor（监控）** | 日志、指标、分布式追踪、告警    | Prometheus, Grafana, ELK Stack |

### 三、按演进与扩展方向分类（X-Ops）

| 方向          | 核心理念                          | 关键实践                            |
| ------------- | --------------------------------- | ----------------------------------- |
| **DevSecOps** | 安全是每个人的责任，安全左移      | SAST/DAST, 依赖项扫描, 容器镜像扫描 |
| **GitOps**    | Git仓库作为基础设施的唯一真实来源 | FluxCD, ArgoCD 自动同步Kubernetes   |
| **AIOps**     | 将AI/ML应用于IT运维               | 智能告警降噪, 异常检测, 根因分析    |
| **MLOps**     | DevOps原则应用于ML模型生命周期    | 模型版本管理, 自动化训练/部署流水线 |
| **FinOps**    | 将财务责任感引入云消费            | 成本可视化, 资源优化, 成本分摊      |

### 四、按组织成熟度分类

| 级别          | 特征                                            |
| ------------- | ----------------------------------------------- |
| L1 传统筒仓式 | 开发运维完全分离，手动交付，沟通依赖工单        |
| L2 初步探索   | 开始引入CI工具，但流程不统一，文化壁垒依然存在  |
| L3 流程标准化 | 标准化CI/CD流水线，IaC和自动化测试广泛应用      |
| L4 度量驱动   | 全面监控和度量体系，数据驱动流程改进            |
| L5 文化内化   | DevOps内化为文化，高度自治，DevSecOps等成为常态 |

---

## 三、技术债务（Technical Debt）

### 引言
技术债务是一个隐喻：为了短期利益选择非最优方案，在未来需要付出额外努力去修复（"利息"）。适度的、有计划的债务可以是战略性工具，但失控的债务会严重拖累开发效率。

### 一、按成因与意图分类

| 类型                  | 定义                                                         | 影响                                             |
| --------------------- | ------------------------------------------------------------ | ------------------------------------------------ |
| **故意的/战略性债务** | 明知有更优方案，出于商业考虑有意识选择权宜之计（如赶期上线） | 管理得当是健康债务，有清晰认知和偿还计划         |
| **无意的/偶然性债务** | 因缺乏经验或知识，在不知不觉中引入非最优设计                 | 更具隐蔽性，往往在问题暴露时才被发现，修复成本高 |
| **腐化的/演化性债务** | 最初设计良好，随时间和环境变化而逐渐变得不适应               | 所有长期项目不可避免，需要持续重构和维护投入     |

### 二、按债务所在领域分类

| 领域                  | 具体表现                                                       |
| --------------------- | -------------------------------------------------------------- |
| **代码级**            | 命名不规范、过长函数、高复杂度、重复代码、魔术数字、死代码     |
| **设计与架构级**      | 紧密耦合、错误抽象、违反SOLID、不合适的技术选型、单体地狱      |
| **测试债务**          | 测试覆盖率低、测试脆弱、缺乏性能/安全测试、手动回归测试        |
| **文档债务**          | 缺失架构图/API文档、注释与逻辑不符、知识库内容过时             |
| **基础设施/部署债务** | 缺乏CI/CD、环境不一致、监控告警缺失、单点故障                  |
| **知识与团队债务**    | 知识孤岛（关键人风险）、沟通不畅、编码规范不统一、新人上手困难 |

### 三、按可见性与影响范围分类

| 类型             | 感知者                                 | 优先级                                 |
| ---------------- | -------------------------------------- | -------------------------------------- |
| **可见的债务**   | 最终用户（Bug/性能/宕机）              | 高，直接损害体验和声誉                 |
| **不可见的债务** | 主要是开发团队（可读性差、新功能难加） | 间接影响，通过降低迭代速度最终影响业务 |
| **局部性债务**   | 单个模块范围                           | 低，可作为日常重构任务                 |
| **系统性债务**   | 贯穿整个系统                           | 极高，需要专门立项大规模重构           |

### 四、马丁·福勒（Martin Fowler）象限分类

|                        | **故意的（Deliberate）**                                     | **无意的（Inadvertent）**                                |
| ---------------------- | ------------------------------------------------------------ | -------------------------------------------------------- |
| **审慎的（Prudent）**  | "我们必须现在发布，之后会重构"（有计划的战略性债务，最健康） | "现在回头看才知道应该怎么做"（随经验增长的自然认知提升） |
| **鲁莽的（Reckless）** | "没时间做设计，先写代码再说"（知道正确做法但选择忽视）       | "什么是设计模式？"（完全缺乏知识，最危险）               |

### 总结
通过多维度分类，团队可以：
- **建立共同语言**，清晰讨论和标记不同类型的债务
- **系统性盘点**项目中的债务，将其可视化
- **制定明智偿还策略**，优先处理"利息"高的债务，计划性保留战略性债务

有效管理技术债务是确保技术平台持续健康支持业务发展的关键。
