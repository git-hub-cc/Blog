# 🐛 AI 辅助 Bug 修复标准检查表 (SOP)

> **核心原则：** 永远不要让 AI 盲猜。将 AI 视为结对编程的资深同事，提供精确的现场信息，强制要求其进行根因分析（RCA），最后再输出最小化的修复代码。

## 阶段一：现场还原与情报收集 (Information Gathering)

*目标：向 AI 提供极其精确的错误现场，消除所有的信息歧义。*

* [ ] **提供完整的报错日志 (Stack Trace & Logs)：** - 拒绝只说“报错了”或“跑不起来”。
* 完整粘贴控制台输出的堆栈信息（如 IntelliJ IDEA 的 Error Log、Flutter 的崩溃追踪，或 `docker logs` 导出的容器报错）。


* [ ] **清晰定义复现步骤 (Steps to Reproduce)：**
* 触发 Bug 的具体前置操作是什么？（例如：“在建立局域网连接后，尝试发送包含特殊字符的笔记文件时……”）
* 当前系统的错误表现是什么？
* 你期望的正确表现是什么？


* [ ] **明确当前的运行环境 (Environment Details)：**
* 操作系统及版本（如：Ubuntu 侧原生运行，还是 Windows 双系统环境下？）。
* 运行容器与框架版本（如：Docker 镜像版本、Capacitor 或 Neutralino 的具体依赖版本）。



## 阶段二：限定边界与上下文注入 (Context Engineering)

*目标：控制 AI 的注意力范围，避免上下文过载带来的逻辑混乱。*

* [ ] **提供精确的有损/无损上下文：**
* **无损注入（核心文件）：** 完整提供直接报错的源文件，或你高度怀疑存在 Bug 的核心业务类（如处理 Dify API 交互的服务类）。
* **有损注入（关联结构）：** 对其他可能关联的模块，仅提供接口定义、类型声明（如 TypeScript 接口或 Dart 模型），或使用 `git diff` 提供最近一次变更记录。


* [ ] **指明技术规范与约束：**
* 如果项目对特定功能有强依赖（例如只能使用项目内建的特定网络请求库），在此处提前声明，防止 AI 引入不需要的第三方依赖包。



## 阶段三：强制根因分析 (Root Cause Analysis)

*目标：在 AI 动手写代码前，先审查其诊断逻辑，确保方向正确。*

* [ ] **发送【诊断提示词】模板：**
> “请基于我提供的报错日志和文件上下文，先不要急于生成修复代码。请按以下结构回答：
> 1. **错误定位**：报错是由哪一行的什么逻辑引起的？
> 2. **根本原因**：为什么会发生这个错误？（例如：是生命周期问题、异步状态竞争，还是跨平台兼容性问题？）
> 3. **修复思路**：你打算用什么策略来修复？给出 1-2 种方案及优劣对比。”
> 
> 


* [ ] **人工审核诊断结果：**
* 判断 AI 给出的“根本原因”是否符合项目实际逻辑。如果逻辑跑偏，立即打断并补充信息纠正。



## 阶段四：最小化修复与验证闭环 (Minimalist Fix & Validation)

*目标：获取高质量代码，并确保修复不破坏现有系统。*

* [ ] **发送【代码生成提示词】模板：**
> “我同意你提出的方案 A。现在请生成修复代码。
> **要求**：
> 1. 遵循 DRY 原则和 KISS 原则。
> 2. 仅输出需要修改的核心代码片段，并明确标注修改的具体位置。
> 3. 保持与现有代码库一致的代码风格和命名规范。”
> 
> 


* [ ] **执行局部验证：**
* 将代码整合进项目，执行最小范围的热重载或局部编译。
* 如果修复失败，带着最新的报错信息和已应用的修改，要求 AI 基于新状态继续排查（避免陷入无限循环重试，超过三次失败必须人工接管）。


* [ ] **评估回归风险 (Regression Check)：**
* 询问 AI：“这个修复方案是否会产生副作用？是否会影响依赖此逻辑的其他模块？”



## 阶段五：经验沉淀与复盘 (Memory & Retrospective)

*目标：让 AI 和你一起从错误中学习，优化长期项目的开发效率。*

* [ ] **记录错误模式 (Update Playbook/Heuristic)：**
* 针对耗时较长的复杂 Bug，让 AI 总结一条经验教训。
* *例如：“记录：在 Neutralino 处理多线程任务时，由于底层通讯机制的限制，必须在主线程确保资源释放，否则会导致僵尸进程。下次开发相关功能请先引入该保护机制。”*


* [ ] **补充测试用例 (Test Case Alongside)：**
* 询问 AI：“为了防止这个 Bug 未来再次出现，请为我生成一个对应的单元测试或集成测试用例。”



---
